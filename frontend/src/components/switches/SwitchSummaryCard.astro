---
import { Card } from "@eliancodes/brutal-ui";
import { Pill, Button } from "@eliancodes/brutal-ui";

const { switch: switchItem } = Astro.props;
---

<Card color="white">
    <div class="flex flex-col md:flex-row items-center md:items-start gap-4">
        <!-- Name section -->
        <div class="flex-shrink-0">
            <p class="poppins text-lg md:text-xl">{switchItem.name}</p>
        </div>
        <!-- Content section -->
        <div class="flex-grow">
            <p class="poppins">{switchItem.content}</p>
        </div>
        <!-- Buttons Section -->
        <div class="mt-4 flex gap-4 justify-end">
            <!-- Edit Button with Dynamic Href -->
            <Button href={`/switches/${switchItem.id}`} color="blue">Edit</Button>
            <!-- Delete Button -->
            <Button id={`delete-${switchItem.id}`} color="red">Delete</Button>
        </div>
    </div>
</Card>

<script define:vars={{ switchId: switchItem.id }}>
    document.getElementById(`delete-${switchId}`)?.addEventListener('click', async (e) => {
        e.preventDefault();
        
        if (!confirm('Are you sure you want to delete this switch?')) {
            return;
        }

        try {
            const response = await fetch(`http://localhost:8000/switches/${switchId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to delete switch');
            }

            alert('Switch deleted successfully');
            window.location.reload(); // Refresh the page to show updated list
            
        } catch (error) {
            console.error('Error deleting switch:', error);
            alert(error instanceof Error ? error.message : 'An unexpected error occurred');
        }
    });
</script>
