---
import Layout from '@layouts/Default.astro';
import { supabase } from "../../lib/supabase";
import RepositoryList from "../../components/repositories/RepositoryList.astro"


// Get user session
const { data: { session } } = await supabase.auth.getSession();
const userEmail = session?.user?.email;

async function fetchUserRepositories(username, token) {
  const url = `https://api.github.com/users/${username}/repos`;

  const response = await fetch(url, {
    method: 'GET',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json',
    },
  });

  if (!response.ok) {
    throw new Error(`Error fetching repositories: ${response.statusText}`);
  }

  const repositories = await response.json();
  return repositories;
}

// Example usage
const username = import.meta.env.GITHUB_USERNAME;
const token = import.meta.env.GITHUB_TOKEN;

const repositories = fetchUserRepositories(username, token)
  .then(repos => {
    console.log('User Repositories:', repos);
  })
  .catch(error => {
    console.error('Error:', error);
  });

---
<Layout
  title='Repositories'
  description='description'
  pageTitle='Repositories'
>
  <!-- <button 
    type="submit" 
    className="border-2 border-black dark:border-white bg-white dark:bg-black text-black dark:text-white px-4 py-2 font-bold shadow-[2px_2px_0px_0px_rgba(0,0,0)] dark:shadow-[2px_2px_0px_0px_rgba(255,255,255)] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0px_0px_rgba(0,0,0)] dark:hover:shadow-[1px_1px_0px_0px_rgba(255,255,255)] transition-all"
  >
    Analyze
  </button> -->
  <main class='bg-white p-6 space-y-4'>
    <RepositoryList repositories={repositories} />
  </main>
</Layout>
