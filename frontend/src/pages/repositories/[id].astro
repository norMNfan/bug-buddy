---
import Layout from '@layouts/Default.astro';
import RepositoryDetailPage from "../../components/RepositoryDetailPage.tsx"

const { id } = Astro.params;
const token = import.meta.env.GITHUB_TOKEN;

async function fetchRepository() {
  const url = `https://api.github.com/repositories/${id}`;

  const response = await fetch(url, {
    method: 'GET',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json',
    },
  });

  if (!response.ok) {
    throw new Error(`Error fetching repository: ${response.statusText}`);
  }

  return await response.json();
}

const repository = await fetchRepository();

---
<Layout
  title='Repository'
  description='description'
  pageTitle='Repository'
>
  <RepositoryDetailPage client:load repo={repository} />
</Layout>
